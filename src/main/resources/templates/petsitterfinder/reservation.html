<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
      layout:decorate="~{layout/default}">
<head>
    <title>ì˜ˆì•½ ëª©ë¡</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        /* í—¤ë” ìŠ¤íƒ€ì¼ ëª…ì‹œ */
        .navbar {
            background-color: #ffffff !important; /* í°ìƒ‰ ë°°ê²½ */
            padding: 10px 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* í—¤ë” ê·¸ë¦¼ì */
        }

        .navbar .nav-link, .navbar-brand {
            color: #000000 !important; /* ê²€ì •ìƒ‰ í…ìŠ¤íŠ¸ */
            font-weight: bold;
        }

        .navbar .nav-link:hover {
            color: #28a745 !important; /* ë…¹ìƒ‰ í…ìŠ¤íŠ¸ */
        }

        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table-hover tbody tr:hover {
            background-color: #f1f1f1;
        }

        .table-striped > tbody > tr:nth-of-type(odd) {
            background-color: #f9f9f9;
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-primary {
            background-color: #007bff;
            border-color: #007bff;
        }

        .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        /* ì „ì²´ì ì¸ ë ˆì´ì•„ì›ƒ íŒ¨ë”© */
        .container {
            padding-top: 40px;
            padding-bottom: 40px;
        }
    </style>
</head>
<body>
<div layout:fragment="main" class="page-body">
    <div class="container">
        <h2 class="mb-4 text-center">ì˜ˆì•½ ëª©ë¡</h2>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="thead-dark">

                <tr>
                    <th scope="col">#</th>
                    <th scope="col">ì˜ˆì•½ ID</th>
                    <th scope="col">í«ì‹œí„° ID</th>
                    <th scope="col">í¬ìŠ¤íŠ¸ ID</th>
                    <th scope="col">ìƒíƒœ</th>
                    <th scope="col">ì˜ˆì•½ ë‚ ì§œ</th>
                    <th scope="col">í˜„ì¬ ëŒë´„ì§„í–‰ ìƒíƒœ</th>
                </tr>
                </thead>
                <tbody>
                <!-- ì˜ˆì•½ ëª©ë¡ ë°ì´í„°ê°€ ì—¬ê¸°ì— ë“¤ì–´ê°‘ë‹ˆë‹¤ -->
                <tr th:each="reservation, iterStat : ${reservationResponseDtoList}"
                    th:data-reservation-id=${reservation.reservationId}>
                    <th scope="row" th:text="${iterStat.index + 1}"></th>
                    <td th:text="${reservation.reservationId}"></td>
                    <td >
                        <a th:href="@{/petsitter/detail/{petsitterId}(petsitterId=${reservation.petSitterId})}" th:text="${reservation.petSitterId}"></a>
                    </td>
                    <td th:text="${reservation.postId}"></td>
                    <td th:text="${reservation.status}"></td>
                    <td th:text="${reservation.createdDate}"></td>
                    <td>
                        <!--              ë²„íŠ¼ ëˆŒë €ì„ ë•Œ ìƒíƒœë³€ê²½ ìš”ì²­í•˜ëŠ” í•¨ìˆ˜ í˜¸ì¶œ-->
<!--                       ì°½ìš±ì´í˜•ì´ ì•Œë ¤ì¤€ ì½”ë“œë¡œ í•´ê²°ëœê±° ê¸°ë¡í•˜ê¸°!!! -->
                        <div class="d-flex justify-content-between">
                        <button  th:if="${reservation.status.getReservationStatus() != 'ìš”ì²­ê±°ì ˆ'}" class="btn btn-sm btn-primary me-2"  th:text="${reservation.status}"  th:onclick="'advanceReservationStatus('+ ${reservation.reservationId} +')'"></button>
                        <form th:action="@{/petsitterfinder/reservation/{reservationId}/reject(reservationId=${reservation.reservationId})}" method="post" onsubmit="return confirm('ì •ë§ ê±°ì ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">
                            <input type="hidden" name="postId" th:value="${reservation.postId}"/>
                        <button class="btn btn-sm btn-danger" type = "submit" >ì˜ˆì•½ìš”ì²­ ê±°ì ˆ</button>
                        </form>
                        </div>
                    </td>

                </tr>

                <!-- ì¶”ê°€ì ì¸ ì˜ˆì•½ ëª©ë¡ì€ ì—¬ê¸°ì— ê³„ì† ì¶”ê°€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤ -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- loader -->
    <div id="ftco-loader" class="show fullscreen">
        <svg class="circular" width="48px" height="48px">
            <circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/>
            <circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10"
                    stroke="#F96D00"/>
        </svg>
    </div>
    <script>
        // ë²„íŠ¼ì˜ onclickí•¨ìˆ˜ì˜ ì´ë¦„ê³¼ ë™ì¼í•˜ê²Œ ì‘ì„±í•´ì¤€ë‹¤. // ìƒíƒœë³€ê²½ AJAX ì½”ë“œ
        function advanceReservationStatus(reservationId) {
            console.log(reservationId)
            $.ajax({
                    type: "POST",
                    url: `/petsitterfinder/reservation/${reservationId}/advance-status`,
                    success: function (res) {
                        const confirmation = confirm(res.status + " ìƒíƒœë¡œ ë³€ê²½ í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ")
                        if (confirmation) {
                            alert(res.status + " ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤. \nğŸ˜€ë‹¤ìŒ ìƒíƒœë¡œ ì§„í–‰í•˜ì‹œë ¤ë©´ í˜„ì¬ ìƒíƒœë¥¼ ë‹¤ì‹œ í´ë¦­í•´ì£¼ì„¸ìš”ğŸ˜€");
                            location.reload(); // í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë³€ê²½ ì‚¬í•­ì„ ë°˜ì˜í•¨
                        }

                    }, error: function (err) {
                        if (err.status === 409) {
                            //   return ResponseEntity.status(HttpStatus.CONFLICT).body(new ReservationResponseDto(e.getMessage()));
                            alert("ì´ë¯¸ ëŒë´„ì´ ì™„ë£Œëœ ê±´ ì…ë‹ˆë‹¤.ğŸ¥²")
                        } else {
                            alert("ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨")
                        }

                    }

                }
            )

            // ì–´ë–¤ ì•„ì´ë””ì¸ì§€ ë°›ê¸° ìœ„í•´ì„œ

            function refuseRequest(reservationId) {
                console.log(reservationId)
                $.ajax({
                    type: "POST",
                    url: `/petsitterfinder/reservation/${reservationId}/deleteRequest`,
                    success: function (res) {
                    },
                    error: function (err) {

                    }
                })
            }
        }
    </script>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

    <script>
        const message = '[[${message}]]';
        message && alert(message);
    </script>
</div>
</body>
</html>
